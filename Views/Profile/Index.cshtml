@model MaksGym.Models.ViewModels.ProfileViewModel
@{
    ViewData["Title"] = "Дашборд";
}

<div class="container my-4">
    <div class="row g-3">

        <div class="col-md-4">
            <div class="card shadow-sm p-4 text-center">
                @if (string.IsNullOrEmpty(Model.PhotoUrl))
                {
                    <img src="https://cdn-icons-png.flaticon.com/512/10/10938.png" class="img-fluid rounded-circle" />
                }
                else
                {
                    <img src="@Model.PhotoUrl" class="img-fluid rounded-circle" />
                }
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow-sm p-4">
                <h3 class="fw-bold">@Model.UserName</h3>

                <h5 class="mt-3">Мої групи</h5>
                <ul class="list-group">
                    @if (Model.groups != null)
                    {
                        @foreach (var group in Model.groups)
                        {
                            <li class="list-group-item">
                                <strong>@group.GroupName</strong> - @(group.Direction?.DirectionName ?? "-")
                                <br />
                                Тренер: @(group.Coach?.User?.FullName ?? "-")
                            </li>
                        }
                    }
                </ul>

                <h5 class="mt-3">Мої абонементи</h5>
                <ul class="list-group">
                    @if (Model.studentsToSubscriptions != null)
                    {
                        @foreach (var sts in Model.studentsToSubscriptions)
                        {
                            <li class="list-group-item">
                                @sts.Subscription.Name
                                <br />
                                Початок: @sts.StartDate.ToString("dd.MM.yyyy")
                                - Кінець: @sts.EndDate.ToString("dd.MM.yyyy")
                                <br />
                                Статус:
                                @if (sts.IsFrozen)
                                {
                                    <span class="text-warning">Заморожено</span>
                                }
                                else if (sts.EndDate < DateTime.Now)
                                {
                                    <span class="text-danger">Неактивний</span>
                                }
                                else
                                {
                                    <span class="text-success">Активний</span>
                                }
                            </li>
                        }
                    }
                </ul>
            </div>
        </div>

        <div class="col-12 mt-4">
            <div class="card shadow-sm p-4">
                <h5 class="fw-bold">Історія транзакцій</h5>
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Дата</th>
                            <th>Сума</th>
                            <th>Підтверджено</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.transactions != null)
                        {
                            @foreach (var trx in Model.transactions)
                            {
                                <tr>
                                    <td>@trx.PaymentDate.ToString("dd.MM.yyyy")</td>
                                    <td>@trx.Value?.ToString("F2") ?? "-" </td>
                                    <td>@(trx.PaymentConfirmed ? "Так" : "Ні")</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-12 mt-4">
            <div class="card shadow-sm p-4">
                <h5 class="fw-bold">Історія занять</h5>
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Дата та час</th>
                            <th>Група</th>
                            <th>Напрямок</th>
                            <th>Тренер</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.trainings != null)
                        {
                            @foreach (var t in Model.trainings)
                            {
                                var group = Model.groups.FirstOrDefault(g => g.GroupsId == t.SheduleId);
                                <tr>
                                    <td>@t.StartTime.ToString("dd.MM.yyyy HH:mm")</td>
                                    <td>@(group?.GroupName ?? "-")</td>
                                    <td>@(group?.Direction?.DirectionName ?? "-")</td>
                                    <td>@(group?.Coach?.User?.FullName ?? "-")</td>
                                    <td>@(t.IsConducted ? "Проведено" : "Не проведено")</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
